## 灰度发布
### 一、定义

- 灰度发布是版本升级平滑过渡的一种方式（也可以增加产品的某些特性）。 

- 当版本升级时，使部分用户使用高版本，其他用户继续使用低版本，待高版本稳定后，逐步扩大范围把所有用户流量都迁移到高版本上面来。 

- AB test也是一种灰度发布方式，让一部分用户继续用A，一部分用户开始用B，如果用户对B没有什么反对意见，那么逐步扩大范围，把所有用户都迁移到B上面来。 



### 二、灰度策略

#### 1、蓝绿部署

蓝绿部署中，一共有两套系统：一套是正在提供服务系统，标记为“绿色”；另一套是准备发布的系统，标记为“蓝色”。两套系统都是功能完善的，并且正在运行的系统，只是系统版本和对外服务情况不同。蓝色系统不对外提供服务，用来做发布前测试，测试过程中发现任何问题，可以直接在蓝色系统上修改，不干扰用户正在使用的系统。蓝色系统经过反复的测试、修改、验证，确定达到上线标准之后，直接将用户切换到蓝色系统

#### 2、金丝雀部署

- 金丝雀发布（Canary）也是一种发布策略，和国内常说的灰度发布是同一类策略。蓝绿部署是准备两套系统，在两套系统之间进行切换，金丝雀策略是只有一套系统，逐渐替换这套系统 
- 只准备一台或几台服务器，在上面部署新版本的系统并测试验证。测试通过之后再观察验证。确认没有异常之后，再将剩余的所有服务器更新。这个方法就是金丝雀发布。 
- 实际操作中还可以做更多控制，譬如说，给最初更新的10台服务器设置较低的权重、控制发送给这10台服务器的请求数，然后逐渐提高权重、增加请求数。这个控制叫做“流量切分”，既可以用于金丝雀发布，也可以用于后面的A/B测试 

#### 3、A/B测试

- 首先需要明确的是，A/B测试和蓝绿部署以及金丝雀，完全是两回事。蓝绿部署和金丝雀是发布策略，目标是确保新上线的系统稳定，关注的是新系统的BUG、隐患。A/B测试是效果测试，同一时间有多个版本的服务对外服务，这些服务都是经过足够测试，达到了上线标准的服务，有差异但是没有新旧之分。 
- A/B测试关注的是不同版本的服务的实际效果，譬如说转化率、订单情况等。 
- A/B测试时，线上同时运行多个版本的服务，这些服务通常会有一些体验上的差异，譬如说页面样式、颜色、操作流程不同。相关人员通过分析各个版本服务的实际效果，选出效果最好的版本。